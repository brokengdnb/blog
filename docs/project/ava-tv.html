<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AVA (TV & Control) &#8211; BrokenG - Blog</title>
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="...Audio &amp; Video Administration (Stream)">
    <link rel="manifest" type="application/manifest+json; charset=utf-8" href="/manifest.json" />
    <meta name="robots" content="all">
    <meta name="author" content="BrokenG">

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>

    
    <meta name="keywords" content="Project">
    <link rel="canonical" href="http://brokengdnb.github.io/blog/project/ava-tv">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for BrokenG - Blog" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?202104080257" type="text/css">

    <!-- Fonts -->
    
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
    

    <style>
        a { background-image: none}
        img {border:0}
    </style>

    <!-- MathJax -->
    

    <!-- Verifications -->
    
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="AVA (TV &amp; Control)">
    <meta property="og:url" content="http://brokengdnb.github.io/blog/project/ava-tv">
    <meta property="og:site_name" content="BrokenG - Blog">

    

    <meta property="og:description" content="" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
    <meta name="twitter:title" content="AVA (TV & Control)" />
    <meta name="twitter:description" content="" />

    <meta name="twitter:url" content="http://brokengdnb.github.io/blog/project/ava-tv" />

    

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="shortcut icon" href="/favicon.ico">

    
</head>

<body class="site animated fade-in-down">
  
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive" style="display: none">
  <div class="mt2 wrap">
    <div class="measure" >
      <a href="/" class="site-title">BrokenG - Blog</a>
      <nav class="site-nav">
        



    
    
    
    
        <a class="nav-link" href="/projects/">Projects</a>
    

    


<a class="nav-link" href="/urls">Links</a>

      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>AVA (TV & Control)</h1>
  <span class="post-meta">January 30, 2018</span><br>
  
  <span class="post-meta small">
  
    4 minute read
  
  </span>
</div>

<article class="post-content">
  <ul>
  <li><a href="#demo">Demo</a></li>
  <li><a href="#download">Download</a></li>
  <li><a href="#dependencies">Dependencies</a></li>
  <li><a href="#run">Run</a></li>
  <li><a href="#index">Index</a></li>
  <li><a href="#todo">TODO</a></li>
  <li><a href="#support">Support</a></li>
  <li><a href="#license">License</a></li>
</ul>

<h2 id="demo">Demo</h2>

<h2 id="download">Download</h2>

<ul>
  <li><a href="https://github.com/brokengdnb/ava-tv/releases/tag/v1">AVA-TV-1.0.zip (~70MB)</a></li>
</ul>

<blockquote>
  <p>MD5</p>
  <ul>
    <li>…</li>
  </ul>
</blockquote>

<h2 id="dependencies">Dependencies</h2>

<ul>
  <li><a href="https://blog.brokeng.com/project/ava-data">AVA-Data</a></li>
</ul>

<h2 id="run">Run</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/brokengdnb/ava-tv <span class="o">&amp;&amp;</span> <span class="nb">cd </span>ava-tv/
npm <span class="nb">install
</span>bower <span class="nb">install
</span>npm run start
</code></pre></div></div>
<blockquote>
  <p>just like that… TV &amp; Control runs on <a href="http://localhost/" title="http://localhost/">http://localhost/</a> but first you need to start AVA-Data on port 3000 to have some data to stream…</p>
</blockquote>

<h2 id="index">Index</h2>

<p>Is split in two parts:</p>

<ul>
  <li>TV / Projector</li>
</ul>

<p><a href="https://github.com/brokengdnb/ava-tv/demo/ava-TV-beamer.png?raw=true" title="beamer"><img src="https://github.com/brokengdnb/ava-tv/blob/master/demo/ava-TV-beamer.png?raw=true" alt="beamer" title="beamer" /></a></p>

<ul>
  <li>Controller</li>
</ul>

<p><a href="https://github.com/brokengdnb/ava-tv/demo/ava-tv-iphone.png?raw=true" title="beamer"><img src="https://github.com/brokengdnb/ava-tv/blob/master/demo/ava-tv-iphone.png?raw=true" alt="iphone" title="beamer" /></a></p>

<p>TV will generate random ID for a room &amp; controller link to connect each other. Each of them can be multiplied by sharing URL link to diferent devices or scanning QR code:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// qr code is changing on a go by IP address of a streaming server and ID of a room</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">idInputChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newData</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">$http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/localIP</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">$scope</span><span class="p">.</span><span class="nx">QRurl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">local</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">newData</span><span class="p">.</span><span class="nx">idRoom</span><span class="p">;</span>
	<span class="p">});</span>
<span class="p">};</span>

</code></pre></div></div>

<p>The app will get it’s own IP adsress from local network as well as IP of database so we can have many televisions connected to one controller as well as we can have many controllers that control one TV, for example if you cannot find your TV remote control… just create new one from your phone/tablet or am I going from bedroom to kitchen? so I transform my phone/control into TV so I can continue on a go while I’m doing something else in somewhere else.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// server.js get requsted /roomID and render front-end (control.html)</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/:room</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">given_room</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">room</span><span class="p">;</span>
	<span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/control.html</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// where basic JS get roomID, transoport to angularJS and socket.IO do the rest</span>
<span class="kd">let</span> <span class="nx">urlParam</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">roomIDparam</span> <span class="o">=</span> <span class="nx">urlParam</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p>Then we got a ‘roomID’ where all is heppening. So the ID of a room can be a string or number or combination of both [a-Z, 1-9] set or randomly generated for each room where is some number of TVs and some number of connected controlers. Hope you catching my drift:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Sync video data throw all connected devices</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">sync video</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">adapter</span><span class="p">.</span><span class="nx">rooms</span><span class="p">[</span><span class="dl">'</span><span class="s1">room-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">roomnum</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">let</span> <span class="nx">roomnum</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">room</span>
		<span class="kd">let</span> <span class="nx">currTime</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">time</span>
		<span class="kd">let</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">state</span>
		<span class="kd">let</span> <span class="nx">videoId</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">videoId</span>

		<span class="c1">// 0 = YouTube, 1 = Daily Motion, 2 = Vimeo, 3 = local file</span>
		<span class="kd">let</span> <span class="nx">playerId</span> <span class="o">=</span> <span class="mi">3</span>

		<span class="c1">// var videoId = io.sockets.adapter.rooms['room-'+roomnum].currVideo</span>
		<span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="k">in</span><span class="p">(</span><span class="dl">"</span><span class="s2">room-</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">roomnum</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">syncVideoClient</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
			<span class="na">time</span><span class="p">:</span> <span class="nx">currTime</span><span class="p">,</span>
			<span class="na">state</span><span class="p">:</span> <span class="nx">state</span><span class="p">,</span>
			<span class="na">videoId</span><span class="p">:</span> <span class="nx">videoId</span><span class="p">,</span>
			<span class="na">playerId</span><span class="p">:</span> <span class="nx">playerId</span>
		<span class="p">})</span>
	<span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>This syncing room ID then time, state (play/pause), file URL and playerId (YouTube,DM,Vimeo or local) stream… not the media itself and that is different. So you can be wacher (user) or you can be admin of the same stream on a go, change URL, seek throw or pause/play… but there is only one admin who can control the main stream at one time for “unlimited” number of users. And every user can be switched to be an admin and takeover main stream for the other users. Ja? Like dat:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Change host</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">change host</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">adapter</span><span class="p">.</span><span class="nx">rooms</span><span class="p">[</span><span class="dl">'</span><span class="s1">room-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">roomnum</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">adapter</span><span class="p">.</span><span class="nx">rooms</span><span class="p">[</span><span class="dl">'</span><span class="s1">room-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">roomnum</span><span class="p">])</span>
            <span class="kd">let</span> <span class="nx">roomnum</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">room</span>
            <span class="kd">let</span> <span class="nx">newHost</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">id</span>
            <span class="kd">let</span> <span class="nx">currHost</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">adapter</span><span class="p">.</span><span class="nx">rooms</span><span class="p">[</span><span class="dl">'</span><span class="s1">room-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">roomnum</span><span class="p">].</span><span class="nx">host</span>

            <span class="c1">// If socket is already the host or not!</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">newHost</span> <span class="o">!=</span> <span class="nx">currHost</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">I want to be the host and my socket id is: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">newHost</span><span class="p">);</span>
                <span class="c1">//console.log(io.sockets.adapter.rooms['room-' + socket.roomnum])</span>

                <span class="c1">// Broadcast to current host and set false</span>
                <span class="nx">socket</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">currHost</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">unSetHost</span><span class="dl">'</span><span class="p">)</span>
                <span class="c1">// Reset host</span>
                <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">adapter</span><span class="p">.</span><span class="nx">rooms</span><span class="p">[</span><span class="dl">'</span><span class="s1">room-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">roomnum</span><span class="p">].</span><span class="nx">host</span> <span class="o">=</span> <span class="nx">newHost</span>
                <span class="c1">// Broadcast to new host and set true</span>
                <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">setHost</span><span class="dl">'</span><span class="p">)</span>

                <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">adapter</span><span class="p">.</span><span class="nx">rooms</span><span class="p">[</span><span class="dl">'</span><span class="s1">room-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">roomnum</span><span class="p">].</span><span class="nx">hostName</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">username</span>
                <span class="c1">// Update host label in all sockets</span>
                <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="k">in</span><span class="p">(</span><span class="dl">"</span><span class="s2">room-</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">roomnum</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">changeHostLabel</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="na">username</span><span class="p">:</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">username</span>
                <span class="p">})</span>
                <span class="c1">// Notify alert</span>
                <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">notify alerts</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="na">alert</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="na">user</span><span class="p">:</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">username</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div></div>

<p><a href="https://github.com/brokengdnb/ava-data/demo-img/emi.png?raw=true" title="preview"><img src="https://github.com/brokengdnb/ava-data/blob/master/demo-img/emi.png?raw=true" alt="MVC" title="preview" /></a></p>

<h3 id="todo">Todo</h3>
<ul>
  <li>add effects (fade in/out) between changes of a stream… soft does not work, so hard one into media itself? Or with implementing other players do effect between them as well?</li>
  <li>add dual-bind connection into EMI for getting time / syncing decks and loading songs into selected deck from this project / playlist</li>
  <li>add list of connected devices localy in room &amp; globaly for all</li>
  <li>add function for changing player on go, like between local server and youtube</li>
  <li>remotely control MUTE function of TVs and selecting wich one in wich room</li>
  <li>update cache button / new data request</li>
  <li>export selected playlist for offline local use (PWA?) without database</li>
  <li>fix favourites new URL data</li>
  <li>fix song’s connected nodes</li>
</ul>

<h2 id="support">Support</h2>

<ul>
  <li><strong>OS X (tested on Mojave 10.14.6)</strong></li>
  <li><strong>iOS &gt; 10 (tested on iPhone 5)</strong></li>
  <li>Linux &amp; Android &gt; 6</li>
  <li><del>Windows</del>  <em>(I don’t have any)</em></li>
</ul>

<h2 id="license">License</h2>

<p>The MIT License.</p>

<p>Copyright (c) 2020 BrokenG</p>

</article>











      </div>
    </div>
  </div>

  <div style="width: 100%; text-align:center;">
 <!-- <a href="https://developers.google.com/speed/pagespeed/insights/" target="_blank" >
    <img src="https://github.com/brokengdnb/blog/blob/master/images/blog-loading.png?raw=true" style="outline : none;border 0"/>
  </a>-->
</div>
<footer class="center">
  <div class="measure">
    <small>
      build on Jekyll<br>
      BrokenG | 2021
    </small>
  </div>
</footer>
<!-- AnchorJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.0.0/anchor.min.js"></script>
<script>
    anchors.options.visible = 'always';
    anchors.add('article h2, article h3, article h4, article h5, article h6');
</script>
<script type="text/javascript">
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js")
    }
</script>

</body>
</html>
